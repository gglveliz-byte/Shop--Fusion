{% extends 'base.html' %}

{% block title %}Carrito - Shop Fusion{% endblock %}

{% block content %}
<div class="container">
    <h1>üõí Tu Carrito</h1>

    {% if productos %}
        <div class="carrito-contenedor">
            <div class="carrito-items">
                {% for item in productos %}
                    <div class="carrito-item">
                        <div class="item-imagen">
                            {% if item.producto.imagen %}
                                <img src="{{ url_for('static', filename='uploads/' + item.producto.imagen) }}" alt="{{ item.producto.nombre }}">
                            {% else %}
                                <div class="sin-imagen">üì¶</div>
                            {% endif %}
                        </div>

                        <div class="item-info">
                            <h3>{{ item.producto.nombre }}</h3>
                            <p class="item-precio">${{ "%.2f"|format(item.precio) }} c/u</p>
                        </div>

                        <div class="item-cantidad">
                            <form method="POST" action="{{ url_for('tienda.actualizar_carrito', id=item.producto.id) }}" class="form-inline">
                                <input type="number" name="cantidad" value="{{ item.cantidad }}" min="1" max="99" class="form-control form-control-sm" onchange="this.form.submit()">
                            </form>
                        </div>

                        <div class="item-subtotal">
                            <p><strong>${{ "%.2f"|format(item.subtotal) }}</strong></p>
                        </div>

                        <div class="item-eliminar">
                            <form method="POST" action="{{ url_for('tienda.eliminar_carrito', id=item.producto.id) }}">
                                <button type="submit" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="carrito-resumen">
                <h3>Resumen del Pedido</h3>

                <div class="resumen-linea">
                    <span>Subtotal:</span>
                    <span>${{ "%.2f"|format(total) }}</span>
                </div>

                <div class="resumen-total">
                    <span>Total:</span>
                    <span>${{ "%.2f"|format(total) }}</span>
                </div>

                {% if afiliado_codigo %}
                    <div class="afiliado-badge">
                        ‚ú® Afiliado: <strong>{{ afiliado_codigo }}</strong>
                    </div>
                {% endif %}

                <a href="{{ url_for('tienda.checkout') }}" class="btn btn-success btn-block btn-lg">Proceder al Checkout</a>
                <a href="{{ url_for('tienda.index') }}" class="btn btn-secondary btn-block">‚Üê Seguir Comprando</a>
            </div>
        </div>
    {% else %}
        <div class="empty-state">
            <p>Tu carrito est√° vac√≠o</p>
            <a href="{{ url_for('tienda.index') }}" class="btn btn-primary">Ir a la tienda</a>
        </div>
    {% endif %}
</div>
{% endblock %}
