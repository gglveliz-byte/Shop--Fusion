{% extends 'base.html' %}

{% block title %}Dashboard Afiliado - Shop Fusion{% endblock %}

{% block content %}
<div class="container">
    <h1>ğŸ‘‹ Bienvenido, {{ afiliado.nombre }}</h1>
    <p class="subtitle">Tu cÃ³digo de afiliado: <strong class="codigo-afiliado">{{ afiliado.codigo }}</strong></p>

    <div class="dashboard-grid">
        <div class="stat-card stat-pendiente">
            <div class="stat-icon">â³</div>
            <div class="stat-info">
                <h3>${{ "%.2f"|format(total_pendiente) }}</h3>
                <p>Comisiones Pendientes</p>
            </div>
        </div>

        <div class="stat-card stat-generada">
            <div class="stat-icon">ğŸ’µ</div>
            <div class="stat-info">
                <h3>${{ "%.2f"|format(total_generado) }}</h3>
                <p>Comisiones Generadas</p>
            </div>
        </div>

        <div class="stat-card stat-pagada">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-info">
                <h3>${{ "%.2f"|format(total_pagado) }}</h3>
                <p>Comisiones Pagadas</p>
            </div>
        </div>

        <div class="stat-card stat-total">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-info">
                <h3>${{ "%.2f"|format(total_ganado) }}</h3>
                <p>Total Ganado</p>
            </div>
        </div>
    </div>

    <div class="afiliado-info-card">
        <h3>ğŸ“Š Tu InformaciÃ³n</h3>
        <p><strong>Porcentaje de comisiÃ³n:</strong> {{ afiliado.porcentaje_comision }}% del margen</p>
        <p><strong>Total de pedidos generados:</strong> {{ total_pedidos }}</p>
        <p><strong>Miembro desde:</strong> {{ afiliado.creado_en.strftime('%d/%m/%Y') }}</p>
    </div>

    {% if ultimas_comisiones %}
        <div class="dashboard-section">
            <h2>ğŸ’° Ãšltimas Comisiones</h2>

            <table class="table">
                <thead>
                    <tr>
                        <th>Pedido</th>
                        <th>Fecha</th>
                        <th>Margen</th>
                        <th>ComisiÃ³n</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comision in ultimas_comisiones %}
                        <tr>
                            <td>Pedido #{{ comision.pedido_id }}</td>
                            <td>{{ comision.creado_en.strftime('%d/%m/%Y') }}</td>
                            <td>${{ "%.2f"|format(comision.margen) }}</td>
                            <td><strong>${{ "%.2f"|format(comision.monto) }}</strong></td>
                            <td>
                                {% if comision.estado == 'pendiente' %}
                                    <span class="badge badge-warning">â³ Pendiente</span>
                                {% elif comision.estado == 'generada' %}
                                    <span class="badge badge-info">âœ… Generada</span>
                                {% else %}
                                    <span class="badge badge-success">ğŸ’° Pagada</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <a href="{{ url_for('afiliado.comisiones') }}" class="btn btn-secondary">Ver todas mis comisiones â†’</a>
        </div>
    {% else %}
        <div class="empty-state">
            <p>AÃºn no has generado comisiones. Â¡Comparte tus links de productos para comenzar a ganar!</p>
            <a href="{{ url_for('afiliado.productos') }}" class="btn btn-primary">Ver Productos</a>
        </div>
    {% endif %}
</div>
{% endblock %}
